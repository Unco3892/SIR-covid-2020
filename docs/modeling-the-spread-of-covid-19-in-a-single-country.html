<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>3 Modeling the spread of COVID-19 in a single country | The Spread of COVID-19</title>
  <meta name="description" content="3 Modeling the spread of COVID-19 in a single country | The Spread of COVID-19" />
  <meta name="generator" content="bookdown 0.20.5 and GitBook 2.6.7" />

  <meta property="og:title" content="3 Modeling the spread of COVID-19 in a single country | The Spread of COVID-19" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="3 Modeling the spread of COVID-19 in a single country | The Spread of COVID-19" />
  
  
  

<meta name="author" content="Azizi, Ilia and Rollini, Maura" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="exploratory-data-analysis.html"/>
<link rel="next" href="modeling-the-spread-of-covid-19-worldwide.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
<script src="libs/htmlwidgets-1.5.1/htmlwidgets.js"></script>
<script src="libs/plotly-binding-4.9.2.1/plotly.js"></script>
<script src="libs/typedarray-0.1/typedarray.min.js"></script>
<link href="libs/crosstalk-1.1.0.1/css/crosstalk.css" rel="stylesheet" />
<script src="libs/crosstalk-1.1.0.1/js/crosstalk.min.js"></script>
<link href="libs/plotly-htmlwidgets-css-1.52.2/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="libs/plotly-main-1.52.2/plotly-latest.min.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#the-data"><i class="fa fa-check"></i><b>1.1</b> The data</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#a-note-on-epidemiological-models"><i class="fa fa-check"></i><b>1.2</b> A note on Epidemiological Models</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#this-project"><i class="fa fa-check"></i><b>1.3</b> This project</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html"><i class="fa fa-check"></i><b>2</b> Exploratory data analysis</a><ul>
<li class="chapter" data-level="2.1" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#description-of-the-state-of-the-spread"><i class="fa fa-check"></i><b>2.1</b> Description of the state of the spread</a></li>
<li class="chapter" data-level="2.2" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#worldwide-map"><i class="fa fa-check"></i><b>2.2</b> Worldwide map</a></li>
<li class="chapter" data-level="2.3" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#data-selection-and-alignment"><i class="fa fa-check"></i><b>2.3</b> Data selection and alignment</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="modeling-the-spread-of-covid-19-in-a-single-country.html"><a href="modeling-the-spread-of-covid-19-in-a-single-country.html"><i class="fa fa-check"></i><b>3</b> Modeling the spread of COVID-19 in a single country</a><ul>
<li class="chapter" data-level="3.1" data-path="modeling-the-spread-of-covid-19-in-a-single-country.html"><a href="modeling-the-spread-of-covid-19-in-a-single-country.html#the-logistic-model-in-r"><i class="fa fa-check"></i><b>3.1</b> The logistic model in R</a></li>
<li class="chapter" data-level="3.2" data-path="modeling-the-spread-of-covid-19-in-a-single-country.html"><a href="modeling-the-spread-of-covid-19-in-a-single-country.html#the-logistic-model-applied-to-data-from-switzerland"><i class="fa fa-check"></i><b>3.2</b> The logistic model applied to data from Switzerland</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="modeling-the-spread-of-covid-19-worldwide.html"><a href="modeling-the-spread-of-covid-19-worldwide.html"><i class="fa fa-check"></i><b>4</b> Modeling the spread of COVID-19 worldwide</a><ul>
<li class="chapter" data-level="4.1" data-path="modeling-the-spread-of-covid-19-worldwide.html"><a href="modeling-the-spread-of-covid-19-worldwide.html#fitting-the-logistic-model-to-every-country"><i class="fa fa-check"></i><b>4.1</b> Fitting the logistic model to every country</a></li>
<li class="chapter" data-level="4.2" data-path="modeling-the-spread-of-covid-19-worldwide.html"><a href="modeling-the-spread-of-covid-19-worldwide.html#fitted-parameters-and-long-term-predictions"><i class="fa fa-check"></i><b>4.2</b> Fitted parameters and long-term predictions</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">The Spread of COVID-19</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="modeling-the-spread-of-covid-19-in-a-single-country" class="section level1">
<h1><span class="header-section-number">3</span> Modeling the spread of COVID-19 in a single country</h1>
<div id="the-logistic-model-in-r" class="section level2">
<h2><span class="header-section-number">3.1</span> The logistic model in R</h2>
<p>Using the filtered dataset, we study the spread of COVID-19 with the logistic model.
Letting <span class="math inline">\(C_{i}(t) = C_{d_{0,i} + t,i}\)</span>, the model for country <span class="math inline">\(i\)</span> can be expressed as:</p>
<p><span class="math display">\[
  C_{i}(t) = \frac{K_{i} \cdot C_{i}(0)}{C_{i}(0) + (K_{i}-C_{i}(0)) \, \exp(-R_{i}\,t)}
\]</span></p>
<p>The goal is to find the final number of cases <span class="math inline">\(K_{i}\)</span> and the infection rate <span class="math inline">\(R_{i}\)</span>. We implement this in R using the following function:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="modeling-the-spread-of-covid-19-in-a-single-country.html#cb1-1"></a><span class="co"># here, we assume that data is a data frame with two variables</span></span>
<span id="cb1-2"><a href="modeling-the-spread-of-covid-19-in-a-single-country.html#cb1-2"></a><span class="co">#  - t: the number of event days</span></span>
<span id="cb1-3"><a href="modeling-the-spread-of-covid-19-in-a-single-country.html#cb1-3"></a><span class="co">#  - confirmed: the number of confirmed cases at time t</span></span>
<span id="cb1-4"><a href="modeling-the-spread-of-covid-19-in-a-single-country.html#cb1-4"></a>logistic_model &lt;-<span class="st"> </span><span class="cf">function</span>(data) {</span>
<span id="cb1-5"><a href="modeling-the-spread-of-covid-19-in-a-single-country.html#cb1-5"></a>  data &lt;-<span class="st"> </span>data <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">arrange</span>(t)</span>
<span id="cb1-6"><a href="modeling-the-spread-of-covid-19-in-a-single-country.html#cb1-6"></a>  C_<span class="dv">0</span> &lt;-<span class="st"> </span>data<span class="op">$</span>confirmed[<span class="dv">1</span>]</span>
<span id="cb1-7"><a href="modeling-the-spread-of-covid-19-in-a-single-country.html#cb1-7"></a>  C_max &lt;-<span class="st"> </span>data<span class="op">$</span>confirmed[<span class="kw">nrow</span>(data)]</span>
<span id="cb1-8"><a href="modeling-the-spread-of-covid-19-in-a-single-country.html#cb1-8"></a>  <span class="kw">nls</span>(</span>
<span id="cb1-9"><a href="modeling-the-spread-of-covid-19-in-a-single-country.html#cb1-9"></a>    <span class="dt">formula =</span> confirmed <span class="op">~</span><span class="st"> </span>K <span class="op">/</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">+</span><span class="st"> </span>((K <span class="op">-</span><span class="st"> </span>C_<span class="dv">0</span>) <span class="op">/</span><span class="st"> </span>C_<span class="dv">0</span>) <span class="op">*</span><span class="st"> </span><span class="kw">exp</span>(<span class="op">-</span>R <span class="op">*</span><span class="st"> </span>t)),</span>
<span id="cb1-10"><a href="modeling-the-spread-of-covid-19-in-a-single-country.html#cb1-10"></a>    <span class="dt">data =</span> data,</span>
<span id="cb1-11"><a href="modeling-the-spread-of-covid-19-in-a-single-country.html#cb1-11"></a>    <span class="dt">start =</span> <span class="kw">list</span>(<span class="dt">K =</span> <span class="dv">2</span> <span class="op">*</span><span class="st"> </span>C_max, <span class="dt">R =</span> <span class="fl">0.5</span>),</span>
<span id="cb1-12"><a href="modeling-the-spread-of-covid-19-in-a-single-country.html#cb1-12"></a>    <span class="dt">control =</span> <span class="kw">nls.control</span>(<span class="dt">minFactor =</span> <span class="fl">1e-6</span>, <span class="dt">maxiter =</span> <span class="dv">100</span>)</span>
<span id="cb1-13"><a href="modeling-the-spread-of-covid-19-in-a-single-country.html#cb1-13"></a>  )</span>
<span id="cb1-14"><a href="modeling-the-spread-of-covid-19-in-a-single-country.html#cb1-14"></a>}</span></code></pre></div>
<p>Notice:</p>
<ul>
<li>We use the nonlinear least square method <code>stats::nls</code> to fit the unknown parameters.</li>
<li>In R, the formula above is <code>confirmed ~ K / (1 + ((K - C_0)/C_0) * exp(-R * t))</code>.</li>
<li>As starting point <span class="math inline">\((K_0, R_0)\)</span> for the optimiser, we set <span class="math inline">\(R_0 = 0.5\)</span> and <span class="math inline">\(K_0 = 2 \, C(t^*)\)</span>, where <span class="math inline">\(t^*\)</span> is the latest information about accumulated confirmed cases.</li>
<li>We further set the <code>control</code> argument as <code>nls.control(minFactor = 1e-6, maxiter = 100)</code>.</li>
</ul>
</div>
<div id="the-logistic-model-applied-to-data-from-switzerland" class="section level2">
<h2><span class="header-section-number">3.2</span> The logistic model applied to data from Switzerland</h2>
<p>From <code>covid19_data_filtered</code>, extract a table <code>covid19_ch</code> which corresponds to data for Switzerland.
Then:</p>
<ul>
<li>We use the function above to fit the logistic model for Switzerland</li>
<li>We describe its output (fitted parameters, <code>broom::tidy()</code> might be useful here)</li>
<li>We discuss the goodness-of-fit.</li>
<li>We plot the fitted curve, as well as observed data points.</li>
<li>And finally, we present the predictions of the model. What is the estimated final size of the epidemic and infection rate in Switzerland?</li>
</ul>
<p>We will start by presenting the data we own for the model we want to describe.</p>
<p><img src="SIR-covid-2020_files/figure-html/fit%20the%20logistic%20model-1.png" width="90%" style="display: block; margin: auto;" /></p>
<p><strong>Comment</strong>: In general we can see that there is an increasing trend for the confirmed cases of COVID-19 in Switzerland (which does not come as a surprise). The trend seems to follow quite well the pace of the observations, and the residuals seems to focus around zero, with some variation, especially towards the end of March.</p>
<table class="table table-striped" style="margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
term
</th>
<th style="text-align:right;">
estimate
</th>
<th style="text-align:right;">
std.error
</th>
<th style="text-align:right;">
statistic
</th>
<th style="text-align:right;">
p.value
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
K
</td>
<td style="text-align:right;">
22253.429
</td>
<td style="text-align:right;">
345.696
</td>
<td style="text-align:right;">
64.4
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
R
</td>
<td style="text-align:right;">
0.227
</td>
<td style="text-align:right;">
0.002
</td>
<td style="text-align:right;">
96.3
</td>
<td style="text-align:right;">
0
</td>
</tr>
</tbody>
</table>
<p><strong>Comment</strong>: we can see that the two parameters found are both statistically significant and both positively correlated to the independent variable.</p>
<p>Now, we will discuss the goodness of fit of the model by comparing it to a null model having the confirmed case explained by a constant variable.</p>
<pre><code>#&gt; 
#&gt; Call:
#&gt; glm(formula = confirmed ~ 1, data = covid19_ch)
#&gt; 
#&gt; Deviance Residuals: 
#&gt;    Min      1Q  Median      3Q     Max  
#&gt;  -8998   -6868    -314    5999   11450  
#&gt; 
#&gt; Coefficients:
#&gt;             Estimate Std. Error t value   Pr(&gt;|t|)    
#&gt; (Intercept)     9650       1370    7.04 0.00000022 ***
#&gt; ---
#&gt; Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
#&gt; 
#&gt; (Dispersion parameter for gaussian family taken to be 48822367)
#&gt; 
#&gt;     Null deviance: 1220559163  on 25  degrees of freedom
#&gt; Residual deviance: 1220559163  on 25  degrees of freedom
#&gt; AIC: 537.1
#&gt; 
#&gt; Number of Fisher Scoring iterations: 2
#&gt; Analysis of Variance Table
#&gt; 
#&gt; Model 1: confirmed ~ K/(1 + ((K - C_0)/C_0) * exp(-R * t))
#&gt; Model 2: confirmed ~ 1
#&gt;   Res.Df Res.Sum Sq Df      Sum Sq F value              Pr(&gt;F)    
#&gt; 1     24    4200305                                               
#&gt; 2     25 1220559163 -1 -1216358858    6950 &lt;0.0000000000000002 ***
#&gt; ---
#&gt; Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<strong>Comment</strong>:
The ANOVA results shows that the hypothesis that the two models have the same effect can be reject are 0.1% (since the p-value is lower than 0.001). Moreover, we also calulate the MAPE to measure the accuracy of the prediction of the model. Having a MAPE of 0.08, we can say that the model is fairly good, being the error small.
</p>
<p>We then plot the fitted curve and the observations.</p>
<p><img src="SIR-covid-2020_files/figure-html/Plot%20the%20fitted%20curve,%20as%20well%20as%20observed%20data%20points-1.png" width="90%" style="display: block; margin: auto;" /></p>
<p><strong>Comment</strong>: As we can see the predictions are following quite well the observations, meaning that the model is working quite well. However, it is woth mentioning that the model is fitted on the whole datasets, which could lead to some form of overfitting, not having a separation in training and test set, meaning that once dealing with new data, the prediction ability of the model could decrease quite a lot.</p>
<p><img src="SIR-covid-2020_files/figure-html/Present%20the%20predictions%20of%20the%20model-1.png" width="90%" style="display: block; margin: auto;" /></p>
The residuals from the plot tell us that many actual numbers were lower than the predicted ones, however this is not too far off from zero, and it is rather expected that the model overpredicts at this point; the number of cases to be higher as the confirmed does not mean that all the people have been identified and due to the limitations in number of testing kits, perhaps more are infected than our data shows.
</p>
</p>
<p>Eventually, the prediction the estimated final size of the epidemic and infection rate in Switzerland is 20400.238.</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="exploratory-data-analysis.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="modeling-the-spread-of-covid-19-worldwide.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
